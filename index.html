<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MailPulse - Serverless Email Automation</title>
  <style>
    body { font-family: Arial; margin: 40px; background: #f9f9f9; }
    h1 { color: #007bff; }
    form { background: #fff; padding: 20px; border-radius: 10px; width: 400px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, textarea { width: 100%; padding: 8px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>üì® MailPulse</h1>
  <form id="emailForm">
    <label>Upload Recipient CSV:</label>
    <input type="file" id="csvFile" accept=".csv" required><br>
    
    <label>Email Subject:</label>
    <input type="text" id="subject" required><br>
    
    <label>Email Message:</label>
    <textarea id="message" rows="5" required></textarea><br>
    
    <button type="submit">Send Emails</button>
  </form>

  <p id="response"></p>

  <script>
    const apiURL = "YOUR_API_GATEWAY_INVOKE_URL";  // e.g. https://abc123.execute-api.us-east-1.amazonaws.com/trigger-email
    const s3Bucket = "mailpulse-recipient-lists";

    document.getElementById("emailForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const file = document.getElementById("csvFile").files[0];
      const subject = document.getElementById("subject").value;
      const message = document.getElementById("message").value;

      const fileName = file.name;

      // 1Ô∏è‚É£ Upload CSV to S3
      const s3UploadURL = `https://${s3Bucket}.s3.amazonaws.com/${fileName}`;
      await fetch(s3UploadURL, {
        method: "PUT",
        body: file,
        headers: { "Content-Type": "text/csv" }
      });

      // 2Ô∏è‚É£ Trigger Lambda via API Gateway
      const res = await fetch(apiURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          bucket: s3Bucket,
          file: fileName,
          subject: subject,
          message: message
        })
      });

      const data = await res.json();
      document.getElementById("response").innerText = JSON.stringify(data);
    });
  </script>
</body>
</html>
